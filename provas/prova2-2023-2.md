# 2023.2 - Prova Banco de Dados II 

1. A prova deve ser feita a caneta, em provas com a escrita a lápis, não serão aceitas reclamações relativas à correção. 
2. Manter celulares desligados!
3. A compreensão das questões faz parte da prova.

1) (2 Pontos) Faça a inserção dos valores abaixo em uma árvore B+ usando o método de Bulk Loading. Considere que a ordem da árvore B+ é 5 (número de ponteiros). Além disso, faça a inserção mantendo 1 espaço vazio em cada nó folha (taxa de ocupação de 80%). Faça passo a passo.

Valores: 0, 2, 4, 6, 8, 16, 17, 20, 22, 24, 26, 28, 30

2) (2 Pontos) Sobre indexação de arquivos, assinale com (V) verdadeiro ou (F) falso:  

a) ( ) Uma tabela que possua um número grande de indices e na qual as colunas da tabela estão fazendo parte de N indices, operações de INSERT, UPDATE, DELETE terão seu **desempenho** afetado devido ao fato de que todos os índices deverão ser ajustados.

b) ( ) Em um banco de dados, **todas as tabelas**, independentemente do tamanho e da frequência com que são atualizadas, possuem pelo menos um **índice (NO CLUSTERED ou CLUSTERED)** a fim de tornar operações de SELECT eficientes.

c) ( ) Índices que implementam estruturas de árvore B+ são eficientes, uma vez que a tarefa de percorrer a estrutura da árvore está diretamente ligada à sua altura. Dessa forma, é **sempre** a melhor opção o uso da estrutura árvore B+, que utiliza o algoritmo de **busca binária** para percorrer a estrutura.

d) ( ) Sobre indices **clusterizados**, podem resultar em ganhos significativos de performance na execução de consultas que acessam registros associados **a um certo valor**, como os itens de uma ordem de compra, por exemplo.

e) ( ) A criação de índices em tabelas com alto grau de **duplicidade de dados** garante um aumento substancial na **eficiência** de consultas a essas tabelas.

Resposta: V, V, F, V, F

3) (3 Pontos) Em PostgreSQL, quando um operação de update ou delete é executada, a tupla não é fisicamente deletada. Para um delete, por exemplo, simplesmente é marcado a tupla como não disponível para transações futuras. Para um update, é executado um insert e então um delete, onde a versão anterior da tupla é marcada como não disponível. 

a) Explique (justifique) o que deve ser feito na página para liberar fisicamente espaço?

b) Construa diagrama de página de tamanho variado, conforme usado pelo Postgres, e ilustre o que acontece com uma operação de update.

4) (3 Pontos) Descreva qual é o efeito físico e vantagem (sobre o ponto de vista de consultas) com a execução do comando "Cluster" na linha 3, conforme abaixo:

1- 

```sql
CREATE TABLE provaBD 
AS SELECT generate_series(1,10000000) AS id1, floor(random() * 10000000 + 1)::int 
AS id2; 
```

2- 
```sql 
create index nomelndex on provaBD(id2);
```

3- 
```sql
cluster provaBD using nomeIndex;
```